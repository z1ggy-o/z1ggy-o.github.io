<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CMU 15-445 2021 Fall Project#4 | Gy's Blog</title>
<meta name=keywords content="DBMS"><meta name=description content="We are implementing a lock-based concurrency control scheme in this project. More specifically, the strict two phase locking protocol.
The concept is not that hard. However, there are many implementation details we need to care about. Especially, sometimes we need to guess what is the test code wants.
You need to read the source code carefully. The instruction of this project is kind vague, or even wrong.
Task 1 - Lock Manager
Read transaction.h, transaction_manager.h, and log_manager.h to learn the APIs first."><meta name=author content="map[link:https://github.com/z1ggy-o name:gyzhu]"><link rel=canonical href=https://z1ggy-o.github.io/posts/projects/cmu15445-project04/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=https://z1ggy-o.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://z1ggy-o.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://z1ggy-o.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://z1ggy-o.github.io/apple-touch-icon.png><link rel=mask-icon href=https://z1ggy-o.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://z1ggy-o.github.io/posts/projects/cmu15445-project04/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload=renderMathInElement(document.body)></script><meta property="og:url" content="https://z1ggy-o.github.io/posts/projects/cmu15445-project04/"><meta property="og:site_name" content="Gy's Blog"><meta property="og:title" content="CMU 15-445 2021 Fall Project#4"><meta property="og:description" content="We are implementing a lock-based concurrency control scheme in this project. More specifically, the strict two phase locking protocol.
The concept is not that hard. However, there are many implementation details we need to care about. Especially, sometimes we need to guess what is the test code wants.
You need to read the source code carefully. The instruction of this project is kind vague, or even wrong.
Task 1 - Lock Manager Read transaction.h, transaction_manager.h, and log_manager.h to learn the APIs first."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-09T14:54:38+00:00"><meta property="article:modified_time" content="2024-12-28T14:09:27+08:00"><meta property="article:tag" content="DBMS"><meta name=twitter:card content="summary"><meta name=twitter:title content="CMU 15-445 2021 Fall Project#4"><meta name=twitter:description content="We are implementing a lock-based concurrency control scheme in this project. More specifically, the strict two phase locking protocol.
The concept is not that hard. However, there are many implementation details we need to care about. Especially, sometimes we need to guess what is the test code wants.
You need to read the source code carefully. The instruction of this project is kind vague, or even wrong.
Task 1 - Lock Manager
Read transaction.h, transaction_manager.h, and log_manager.h to learn the APIs first."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"","item":"https://z1ggy-o.github.io/posts/"},{"@type":"ListItem","position":2,"name":"CMU 15-445 2021 Fall Project#4","item":"https://z1ggy-o.github.io/posts/projects/cmu15445-project04/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CMU 15-445 2021 Fall Project#4","name":"CMU 15-445 2021 Fall Project#4","description":"We are implementing a lock-based concurrency control scheme in this project. More specifically, the strict two phase locking protocol.\nThe concept is not that hard. However, there are many implementation details we need to care about. Especially, sometimes we need to guess what is the test code wants.\nYou need to read the source code carefully. The instruction of this project is kind vague, or even wrong.\nTask 1 - Lock Manager Read transaction.h, transaction_manager.h, and log_manager.h to learn the APIs first.\n","keywords":["DBMS"],"articleBody":"We are implementing a lock-based concurrency control scheme in this project. More specifically, the strict two phase locking protocol.\nThe concept is not that hard. However, there are many implementation details we need to care about. Especially, sometimes we need to guess what is the test code wants.\nYou need to read the source code carefully. The instruction of this project is kind vague, or even wrong.\nTask 1 - Lock Manager Read transaction.h, transaction_manager.h, and log_manager.h to learn the APIs first.\nThe log manager only communicates with transactions and the transaction manager. As the textbook says, the log manager tracks all the lock requests for different tuples; a transaction tracks all the locks it holds for different tuples.\nAll the works are around the management of the hash table in the log_manager and the two sets that track locks in transaction. We only need to implement the basic logic structure of each API in this task because we will modify them in the following tasks.\nTask 2 - Deadlock Prevention We use wound-wait here, which means, when requesting a lock on a data item, the “younger” transactions wait for the “older” transactions, while the “older” transactions kill the “younger” transactions.\nBecause the log_manager and transaction track the lock requests for each tuple and each transaction, this part of work is\nTask 3 Concurrency Control The instruction and code are inconsistent. The instruction asks us to maintain the write sets in transactions. However, the table write sets have already been handled by the APIs in table_heap.cpp. As a result, actually, we do not need to maintain the tuple write sets by ourself.\nEach transaction can execute several queries. We should consider this and modify our lock manager. For example, what should we do if a transaction inserts some tuples, then read them?\nTo achieve different isolation level with strict 2PL protocol, we need to use these locks properly in different executor. According to the lecture slides, we should:\nSerializable: Obtain all locks first; ;plus index locks, plus strict 2PL. Repeatable Reads: Same as above, but no index locks. Read Committed: Same as above, but share locks are released immediately. Read Uncommitted: Same as above but allows dirty reads (no share locks). Some exceptions that are thrown from the lock manager cannot be fetched by the test code. So, letting the caller of the lock manager to handle lock fails is a better choice. This costed me few hours to debug..\nResult ","wordCount":"411","inLanguage":"en","datePublished":"2022-05-09T14:54:38Z","dateModified":"2024-12-28T14:09:27+08:00","author":{"@type":"Person","name":{"link":"https://github.com/z1ggy-o","name":"gyzhu"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://z1ggy-o.github.io/posts/projects/cmu15445-project04/"},"publisher":{"@type":"Organization","name":"Gy's Blog","logo":{"@type":"ImageObject","url":"https://z1ggy-o.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://z1ggy-o.github.io/ accesskey=h title="Gy's Blog (Alt + H)">Gy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://z1ggy-o.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://z1ggy-o.github.io/weekly/ title=Logs><span>Logs</span></a></li><li><a href=https://z1ggy-o.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://z1ggy-o.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://z1ggy-o.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://z1ggy-o.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://z1ggy-o.github.io/posts/></a></div><h1 class="post-title entry-hint-parent">CMU 15-445 2021 Fall Project#4</h1><div class=post-meta><span title='2022-05-09 14:54:38 +0000 UTC'>May 9, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;map[link:https://github.com/z1ggy-o name:gyzhu]</div></header><div class=post-content><p>We are implementing a lock-based concurrency control scheme in this project. More specifically, the <strong>strict two phase locking protocol</strong>.</p><p>The concept is not that hard. However, there are many implementation details we need to care about. Especially, sometimes we need to guess what is the test code wants.</p><p>You need to read the source code carefully. The instruction of this project is kind vague, or even wrong.</p><h2 id=task-1---lock-manager>Task 1 - Lock Manager<a hidden class=anchor aria-hidden=true href=#task-1---lock-manager>#</a></h2><p>Read <code>transaction.h</code>, <code>transaction_manager.h</code>, and <code>log_manager.h</code> to learn the APIs first.</p><p>The log manager only communicates with transactions and the transaction manager. As the textbook says, the log manager tracks all the lock requests for different tuples; a transaction tracks all the locks it holds for different tuples.</p><p>All the works are around the management of the hash table in the <code>log_manager</code> and the two sets that track locks in <code>transaction</code>. We only need to implement the basic logic structure of each API in this task because we will modify them in the following tasks.</p><h2 id=task-2---deadlock-prevention>Task 2 - Deadlock Prevention<a hidden class=anchor aria-hidden=true href=#task-2---deadlock-prevention>#</a></h2><p>We use <strong>wound-wait</strong> here, which means, when requesting a lock on a data item, the &ldquo;younger&rdquo; transactions wait for the &ldquo;older&rdquo; transactions, while the &ldquo;older&rdquo; transactions kill the &ldquo;younger&rdquo; transactions.</p><p>Because the <code>log_manager</code> and <code>transaction</code> track the lock requests for each tuple and each transaction, this part of work is</p><h2 id=task-3-concurrency-control>Task 3 Concurrency Control<a hidden class=anchor aria-hidden=true href=#task-3-concurrency-control>#</a></h2><p>The instruction and code are inconsistent. The instruction asks us to maintain the write sets in transactions. However, the table write sets have already been handled by the APIs in <code>table_heap.cpp</code>. As a result, actually, we do not need to maintain the tuple write sets by ourself.</p><p>Each transaction can execute several queries. We should consider this and modify our lock manager. For example, what should we do if a transaction inserts some tuples, then read them?</p><p>To achieve different isolation level with strict 2PL protocol, we need to use these locks properly in different executor. According to the lecture slides, we should:</p><ul><li><strong>Serializable</strong>: Obtain all locks first; ;plus index locks, plus strict 2PL.</li><li><strong>Repeatable Reads</strong>: Same as above, but no index locks.</li><li><strong>Read Committed</strong>: Same as above, but share locks are released immediately.</li><li><strong>Read Uncommitted</strong>: Same as above but allows dirty reads (no share locks).</li></ul><p>Some exceptions that are thrown from the lock manager cannot be fetched by the test code. So, letting the caller of the lock manager to handle lock fails is a better choice. This costed me few hours to debug..</p><h2 id=result>Result<a hidden class=anchor aria-hidden=true href=#result>#</a></h2><p><img alt=image.png loading=lazy src=https://raw.githubusercontent.com/z1ggy-o/static_resources/main/img/cmu15445-project03-grades.png></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://z1ggy-o.github.io/tags/dbms/>DBMS</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://z1ggy-o.github.io/>Gy's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>